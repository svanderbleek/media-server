<html>
  <head>
    <script>
      const MS = {
        Upload: {},
        token: "test"
      };

      MS.Upload.init = function(file) {
        debugger
        fetch('localhost:3333/uploads/', {
          method: 'post',
          body: JSON.stringify({
            fileType: file.type,
            token: MS.token
          })
        })
        .then(MS.Upload.start(file));
      };

      MS.Upload.start = function(file) {
        return function(data) {
          const start = data.actions.start;
          fetch(start.url, {
            method: start.method,
            body: file
          })
          .then(MS.Upload.finish)
          .catch(MS.Upload.catchStart)
        };
      };
      
      MS.Upload.finish = function (data) {
        debugger
      };

      MS.Upload.catchStart = function (err) {
        debugger
      };

      MS.file = function(selector) {
        return function() {
          const input = document.querySelector(selector);
          const file = input.files[0];
          input.addEventListener('change', MS.Upload.init(file))
        };
      };

      document.addEventListener('DOMContentLoaded', MS.file('#file-input')
    </script>
  </head>
  <body>
    <form id="file-form" action="/">
      <input id="file-input" type="file">
    </form>
  </body>
</html>
