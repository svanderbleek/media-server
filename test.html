<html>
  <head>
    <script>
      function formBinder(id) {
        const input = document.querySelector(id);
        return dataHandler(input);
      };

      function dataHandler(input) {
        return function(data) {
          const start = startAction(data);
          const fetcher = fetchListener(start);
          listenInput(input, fetcher)
        }
      };

      const startAction = data => data.actions.start
      const listenInput = (input, listener) => input.addEventListener('change', listener)

      function fetchListener(action) {
        return function(event) {
          const input = event.target;
          const file = input.files[0];
          debugger
          return fetch(action.url, {
            method: action.method,
            body: file
          });
        };
      };

      function initFileInput(id) {
        return function() {
          fetch('http://localhost:3333/uploads/test', {
            method: 'post',
          })
          .then(resp => resp.json())
          .then(formBinder(id));
        };
      };

      document.addEventListener('DOMContentLoaded', initFileInput('#file-input'))
    </script>
  </head>
  <body>
    <form id="file-form" action="/">
      <input id="file-input" type="file">
      <button type="submit">go</button>
    </form>
  </body>
</html>
